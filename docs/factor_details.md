# 因子构建与稳健性检查

> 数据范围：2019-08-09 ~ 2025-12-05，共 299 个周度观测（与 `factor_returns_f5.parquet` 和 6 个动量窗口对齐）。

## 因子构建方法
- **MKT_RF**：`weekly_panel.parquet` 中所有股票的市值加权周收益，减去当周 `rf_weekly`；由 `code/factor_pipeline.py` 生成。
- **SMB**：在每周横截面上按市值做 5 分位（Q1~Q5），取 Q1（最小市值）与 Q5（最大市值）组合的市值加权收益差。
- **HML**：以账面市值比 = 账面权益 / 市值（滞后 30 天）做 5 分位，High (Q5) − Low (Q1)。
- **RMW**：盈利率 = `profit_metric / book_equity`，同样用 5 分位求 High − Low。
- **CMA**：投资率取 `F080601A`（资产增长），计算 Low (保守，Q1) − High (激进，Q5)。
- **MOM_EQ**：`code/momentum_comparison.py` 先构建 4/8/16/26/52/78 周动量（均跳过最近 1~4 周、以 quintile High-Low 构造），再对六条动量因子取等权平均，得到 `MOM_EQ`。

## 因子相关性
|        |   MKT_RF |    SMB |    HML |    RMW |    CMA |   MOM_EQ |
|:-------|---------:|-------:|-------:|-------:|-------:|---------:|
| MKT_RF |    1.000 |  0.055 | -0.399 | -0.132 |  0.004 |    0.043 |
| SMB    |    0.055 |  1.000 |  0.138 |  0.215 |  0.044 |   -0.357 |
| HML    |   -0.399 |  0.138 |  1.000 |  0.123 | -0.002 |   -0.376 |
| RMW    |   -0.132 |  0.215 |  0.123 |  1.000 |  0.073 |   -0.114 |
| CMA    |    0.004 |  0.044 | -0.002 |  0.073 |  1.000 |   -0.100 |
| MOM_EQ |    0.043 | -0.357 | -0.376 | -0.114 | -0.100 |    1.000 |

> SMB/HML 与 `MOM_EQ` 呈中度负相关（-0.36~-0.38），表明动量与小盘、价值收益差仍存在互补；其他相关系数均在 ±0.4 内，避免了严重多重共线性。

## 平稳性（ADF）检验
| factor   |    adf_stat |        pvalue |  crit_1pct |  crit_5pct |  crit_10pct |
|:---------|-----------:|--------------:|-----------:|-----------:|------------:|
| MKT_RF   | -18.177360 | 2.44e-30      | -3.452486  | -2.871288  |  -2.571964  |
| SMB      | -13.542444 | 2.50e-25      | -3.452561  | -2.871321  |  -2.571982  |
| HML      |  -7.477457 | 4.87e-11      | -3.452867  | -2.871455  |  -2.572053  |
| RMW      |  -4.052817 | 1.16e-03      | -3.453102  | -2.871559  |  -2.572108  |
| CMA      | -19.237875 | 0.00e+00      | -3.452486  | -2.871288  |  -2.571964  |
| MOM_EQ   | -17.933444 | 2.88e-30      | -3.452486  | -2.871288  |  -2.571964  |

> 所有因子的 ADF 统计量都低于 1% 临界值（p 值 < 0.01），表明周度收益序列在当前样本内可视为平稳过程，可直接应用于时间序回归和相关性分析。

上述两个表格由 `docs/factor_correlations.csv`、`docs/factor_stationarity.csv` 导出；如需刷新，请执行：
```bash
python code/momentum_comparison.py   # 先生成/更新所有动量因子
python code/factor_diagnostics.py    # 输出相关性与 ADF 结果
```
